var COLUMN_TYPE=["todo","doing","done"],DOING_LIMIT=3,DB={getData:function(){if("undefined"!=typeof Storage){var a;try{a=JSON.parse(localStorage.getItem("list"))||{},COLUMN_TYPE.forEach(function(b){Array.isArray(a[b])||(a[b]=[])})}catch(b){a={}}return a}return alert("Sorry! Your browser is too old to use this application."),{}},setData:function(a){localStorage.setItem("list",JSON.stringify(a))}},Util={showLoading:function(){$(".overlay").removeClass("hidden")},hideLoading:function(){$(".overlay").addClass("hidden")},openAlertModal:function(){$("#modal-alert").openModal()},openConfirmModal:function(){$("#modal-confirm").openModal()},closeConfirmModal:function(){$("#modal-confirm").closeModal()}},list=DB.getData(),app={init:function(){var a=this;COLUMN_TYPE.forEach(function(b){var c=list[b]||[];c.forEach(function(c){a.addJobToList(b,c)})}),this.sortJob(),Util.hideLoading()},sortJob:function(){var a=this;$(".sorted-list").sortable({connectWith:".sorted-list",placeholder:"ui-state-highlight",start:function(a,b){$(b.item[0]).addClass("dragging"),b.item.oldColumnType=b.item.context.parentElement.getAttribute("id"),b.item.oldItemPosition=b.item.index()},stop:function(b,c){$(c.item[0]).removeClass("dragging");var d=c.item,e=d.oldItemPosition,f=d.oldColumnType,g=d.context.parentElement.getAttribute("id");"doing"==g&&list[g].length>=DOING_LIMIT?($(".sorted-list").sortable("cancel"),Util.openAlertModal()):(list[f].splice(e,1),a.updateJobCount(f),list[g].splice(d.index(),0,d[0].innerText),a.updateJobCount(g),DB.setData(list))}})},newJob:function(a,b,c){var d=$(c).val(),e=window.event||a;13===e.keyCode&&""!==d&&(list[b]||(list[b]=[]),"doing"==b&&list[b].length>=DOING_LIMIT?Util.openAlertModal():(list[b].push(d),DB.setData(list),this.addJobToList(b,d)),$(c).val(""))},addJobToList:function(a,b){var c=$("<div></div>");c.text(b);var d='<div class="collection-item"> '+c.html()+'<span class="badge" onclick="app.deleteJob(this)"><i class="tiny material-icons">delete</i></span></div>';$("#"+a).append(d),this.updateJobCount(a)},deleteJob:function(a){var b=$("#btn-delete"),c=this;Util.openConfirmModal(),b.off("click"),b.on("click",function(){var b=$(a).parent(),d=b.parent().attr("id"),e=$("#"+d+" .collection-item").index(b);list[d].splice(e,1),DB.setData(list),b.remove(),c.updateJobCount(d),Util.closeConfirmModal()})},updateJobCount:function(a){$("#"+a).prev("h5").children(".count").text("("+list[a].length+")")}};$(function(){app.init()});